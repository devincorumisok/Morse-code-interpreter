<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Interpreter</title>
    <style>
        body {
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #message {
            font-size: 1.2rem;
            color: #333;
            margin-top: 20px;
        }

        #status {
            margin-top: 10px;
            color: #666;
        }

        button {
            padding: 10px 20px;
            font-size: 1rem;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Morse Code Interpreter</h1>
    <button id="start-btn">Start Listening</button>
    <button id="stop-btn" disabled>Stop Listening</button>
    <div id="message">Detected message: </div>
    <div id="status">Status: Not listening</div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const messageDiv = document.getElementById('message');
        const statusDiv = document.getElementById('status');

        let audioContext;
        let analyser;
        let microphone;
        let dataArray;
        let morseCode = '';
        let recording = false;
        let startTime = null;
        let isSounding = false;
        const morseDictionary = {
            '.-': 'A', '-...': 'B', '-.-.': 'C', '-..': 'D', '.': 'E',
            '..-.': 'F', '--.': 'G', '....': 'H', '..': 'I', '.---': 'J',
            '-.-': 'K', '.-..': 'L', '--': 'M', '-.': 'N', '---': 'O',
            '.--.': 'P', '--.-': 'Q', '.-.': 'R', '...': 'S', '-': 'T',
            '..-': 'U', '...-': 'V', '.--': 'W', '-..-': 'X', '-.--': 'Y',
            '--..': 'Z', '-----': '0', '.----': '1', '..---': '2',
            '...--': '3', '....-': '4', '.....': '5', '-....': '6',
            '--...': '7', '---..': '8', '----.': '9'
        };

        function translateMorseToText(morse) {
            return morse.trim().split(' ').map(code => morseDictionary[code] || '').join('');
        }

        function startListening() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 2048;
            dataArray = new Uint8Array(analyser.fftSize);

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    microphone = audioContext.createMediaStreamSource(stream);
                    microphone.connect(analyser);
                    recording = true;
                    statusDiv.textContent = 'Status: Listening...';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    processAudio();
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                    statusDiv.textContent = 'Status: Microphone access denied';
                });
        }

        function stopListening() {
            if (microphone) {
                microphone.disconnect();
            }
            if (audioContext) {
                audioContext.close();
            }
            recording = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusDiv.textContent = 'Status: Not listening';
        }

        function processAudio() {
            if (!recording) return;

            analyser.getByteTimeDomainData(dataArray);
            const amplitude = Math.max(...dataArray) - Math.min(...dataArray);
            const currentTime = Date.now();

            if (amplitude > 50) {
                if (!isSounding) {
                    startTime = currentTime;
                    isSounding = true;
                }
            } else {
                if (isSounding) {
                    const duration = currentTime - startTime;
                    if (duration < 200) {
                        morseCode += '.';
                    } else {
                        morseCode += '-';
                    }
                    isSounding = false;
                    morseCode += ' ';
                }
            }

            if (!isSounding && currentTime - startTime > 600 && morseCode.endsWith(' ')) {
                morseCode = morseCode.trim();
                const translatedText = translateMorseToText(morseCode);
                messageDiv.textContent = 'Detected message: ' + translatedText;
                morseCode = '';
            }

            requestAnimationFrame(processAudio);
        }

        startBtn.addEventListener('click', startListening);
        stopBtn.addEventListener('click', stopListening);
    </script>
</body>
